# Generated by Django 6.0.1 on 2026-02-06 11:26

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('accounts', '0003_remove_user_profile_photo_user_profile_photo_data_and_more'),
        ('employees', '0007_add_service_request_models'),
        ('leave', '0004_leave_planning_models'),
        ('organization', '0002_directorate_department_directorate_division_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='LeaveApprovalWorkflowTemplate',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('location_category', models.CharField(choices=[('DISTRICT', 'District Office'), ('REGIONAL', 'Regional Office'), ('CPC', 'Claims Processing Center'), ('HEAD_OFFICE', 'Head Office'), ('STANDALONE', 'Standalone Office')], max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False, help_text='Use this workflow if no specific mapping exists')),
                ('max_levels', models.PositiveSmallIntegerField(default=5)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'leave_approval_workflow_templates',
                'ordering': ['location_category', 'name'],
            },
        ),
        migrations.CreateModel(
            name='LeaveApprovalWorkflowLevel',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('level', models.PositiveSmallIntegerField()),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True)),
                ('approver_type', models.CharField(choices=[('SUPERVISOR', 'Direct Supervisor'), ('UNIT_HEAD', 'Unit Head'), ('DEPT_HEAD', 'Department Head'), ('DIST_MGR', 'District Manager'), ('REG_DIR', 'Regional Director'), ('DEP_DIR', 'Deputy Director'), ('DIRECTOR', 'Director'), ('DCE', 'Deputy CEO'), ('CEO', 'CEO'), ('ROLE', 'Based on Role'), ('USER', 'Specific User')], max_length=20)),
                ('days_threshold', models.DecimalField(blank=True, decimal_places=2, help_text='Only require this level if days exceed threshold', max_digits=5, null=True)),
                ('apply_to_grades', models.JSONField(blank=True, default=list, help_text='List of grade codes this level applies to (empty = all)')),
                ('can_skip', models.BooleanField(default=False, help_text='Can be skipped if approver is same as previous level')),
                ('can_reject', models.BooleanField(default=True)),
                ('can_modify_dates', models.BooleanField(default=False)),
                ('requires_comments', models.BooleanField(default=False)),
                ('auto_escalate_hours', models.PositiveIntegerField(blank=True, help_text='Auto-escalate after this many hours (null = no auto-escalate)', null=True)),
                ('approver_role', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='leave_approval_levels', to='accounts.role')),
                ('approver_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='leave_approval_levels', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='levels', to='leave.leaveapprovalworkflowtemplate')),
            ],
            options={
                'db_table': 'leave_approval_workflow_levels',
                'ordering': ['template', 'level'],
                'unique_together': {('template', 'level')},
            },
        ),
        migrations.CreateModel(
            name='LeaveRelieverValidation',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('validation_status', models.CharField(choices=[('PENDING', 'Pending Validation'), ('VALID', 'Valid - On Duty'), ('INVALID', 'Invalid - Reliever on Leave'), ('CONFLICT', 'Conflict - Already Relieving Others'), ('APPROVED', 'Override Approved')], default='PENDING', max_length=20)),
                ('validation_message', models.TextField(blank=True)),
                ('override_approved', models.BooleanField(default=False)),
                ('override_reason', models.TextField(blank=True)),
                ('override_at', models.DateTimeField(blank=True, null=True)),
                ('validated_at', models.DateTimeField(blank=True, null=True)),
                ('conflicting_leave', models.ForeignKey(blank=True, help_text='Leave request where reliever is also on leave', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='conflicting_reliever_requests', to='leave.leaverequest')),
                ('conflicting_reliever_duty', models.ForeignKey(blank=True, help_text='Another reliever assignment that conflicts', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='overlapping_assignments', to='leave.leaverelievervalidation')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('leave_request', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='reliever_validation', to='leave.leaverequest')),
                ('override_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reliever_overrides', to=settings.AUTH_USER_MODEL)),
                ('reliever', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reliever_assignments', to='employees.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'leave_reliever_validations',
            },
        ),
        migrations.CreateModel(
            name='LeaveRequestWorkflowStatus',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('current_level', models.PositiveSmallIntegerField(default=1)),
                ('total_levels', models.PositiveSmallIntegerField(default=1)),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('IN_PROGRESS', 'In Progress'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=20)),
                ('pending_since', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('leave_request', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='workflow_status', to='leave.leaverequest')),
                ('pending_approver', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pending_leave_approvals', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('workflow_template', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='request_statuses', to='leave.leaveapprovalworkflowtemplate')),
            ],
            options={
                'db_table': 'leave_request_workflow_status',
            },
        ),
        migrations.CreateModel(
            name='LeaveApprovalAction',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('level_number', models.PositiveSmallIntegerField()),
                ('action', models.CharField(choices=[('APPROVE', 'Approved'), ('REJECT', 'Rejected'), ('FORWARD', 'Forwarded'), ('RETURN', 'Returned for Revision'), ('ESCALATE', 'Escalated'), ('DELEGATE', 'Delegated')], max_length=20)),
                ('acted_at', models.DateTimeField(auto_now_add=True)),
                ('comments', models.TextField(blank=True)),
                ('original_start_date', models.DateField(blank=True, null=True)),
                ('original_end_date', models.DateField(blank=True, null=True)),
                ('modified_start_date', models.DateField(blank=True, null=True)),
                ('modified_end_date', models.DateField(blank=True, null=True)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='leave_approval_actions', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('delegated_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='delegated_leave_actions', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('workflow_level', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='leave.leaveapprovalworkflowlevel')),
                ('workflow_status', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='actions', to='leave.leaverequestworkflowstatus')),
            ],
            options={
                'db_table': 'leave_approval_actions',
                'ordering': ['workflow_status', 'level_number', 'acted_at'],
            },
        ),
        migrations.CreateModel(
            name='LocationWorkflowMapping',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('effective_from', models.DateField()),
                ('effective_to', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('location', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='leave_workflow_mappings', to='organization.worklocation')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('workflow_template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='location_mappings', to='leave.leaveapprovalworkflowtemplate')),
            ],
            options={
                'db_table': 'location_workflow_mappings',
                'ordering': ['location', '-effective_from'],
            },
        ),
    ]
