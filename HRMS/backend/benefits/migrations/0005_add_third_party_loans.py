# Generated by Django 6.0.1 on 2026-02-06 11:21

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('benefits', '0004_add_nhia_specific_benefits'),
        ('employees', '0007_add_service_request_models'),
        ('payroll', '0008_payroll_settings'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ThirdPartyDeduction',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('deduction_number', models.CharField(db_index=True, max_length=20, unique=True)),
                ('external_reference', models.CharField(blank=True, help_text='Reference number from the lender (e.g., loan account number)', max_length=50)),
                ('deduction_type', models.CharField(choices=[('FIXED', 'Fixed Amount'), ('PERCENT', 'Percentage of Salary'), ('LOAN', 'Loan Repayment'), ('SAVINGS', 'Savings Contribution')], default='FIXED', max_length=20)),
                ('deduction_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Fixed amount to deduct (if type is FIXED)', max_digits=12, null=True)),
                ('deduction_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Percentage to deduct (if type is PERCENT)', max_digits=5, null=True)),
                ('salary_component', models.CharField(choices=[('GROSS', 'Gross Salary'), ('BASIC', 'Basic Salary'), ('NET', 'Net Salary')], default='GROSS', help_text='Salary component to calculate percentage from', max_length=20)),
                ('principal_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('interest_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('total_loan_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('total_repaid', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('outstanding_balance', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField(blank=True, null=True)),
                ('tenure_months', models.PositiveSmallIntegerField(blank=True, help_text='Expected duration in months', null=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING', 'Pending Approval'), ('ACTIVE', 'Active'), ('SUSPENDED', 'Suspended'), ('COMPLETED', 'Completed'), ('CANCELLED', 'Cancelled')], db_index=True, default='DRAFT', max_length=20)),
                ('total_deductions', models.PositiveIntegerField(default=0)),
                ('total_deducted_amount', models.DecimalField(decimal_places=2, default=0, max_digits=14)),
                ('last_deduction_date', models.DateField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('purpose', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_third_party_deductions', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='third_party_deductions', to='employees.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'third_party_deductions',
                'ordering': ['-start_date'],
            },
        ),
        migrations.CreateModel(
            name='StudentLoanAccount',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sltf_account_number', models.CharField(max_length=50, unique=True)),
                ('beneficiary_id', models.CharField(blank=True, max_length=50)),
                ('institution_attended', models.CharField(blank=True, max_length=200)),
                ('program_studied', models.CharField(blank=True, max_length=200)),
                ('graduation_year', models.PositiveIntegerField(blank=True, null=True)),
                ('original_loan_amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('total_with_interest', models.DecimalField(decimal_places=2, max_digits=12)),
                ('interest_rate', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('monthly_deduction', models.DecimalField(decimal_places=2, max_digits=12)),
                ('total_repaid', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('outstanding_balance', models.DecimalField(decimal_places=2, max_digits=12)),
                ('repayment_status', models.CharField(choices=[('NOT_STARTED', 'Not Started'), ('ACTIVE', 'Active Repayment'), ('DEFERRED', 'Deferred'), ('COMPLETED', 'Fully Repaid'), ('DEFAULTED', 'Defaulted')], default='ACTIVE', max_length=20)),
                ('repayment_start_date', models.DateField(blank=True, null=True)),
                ('expected_completion_date', models.DateField(blank=True, null=True)),
                ('actual_completion_date', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='student_loan_accounts', to='employees.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('active_deduction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='student_loan', to='benefits.thirdpartydeduction')),
            ],
            options={
                'db_table': 'student_loan_accounts',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='RentDeduction',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('housing_type', models.CharField(choices=[('GOVT', 'Government Bungalow'), ('OFFICIAL', 'Official Quarters'), ('SUBSIDIZED', 'Subsidized Housing'), ('OTHER', 'Other')], default='GOVT', max_length=20)),
                ('property_address', models.TextField(blank=True)),
                ('property_number', models.CharField(blank=True, max_length=50)),
                ('deduction_percentage', models.DecimalField(decimal_places=2, default=10.0, help_text='Percentage of basic salary', max_digits=5)),
                ('fixed_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Fixed rent amount if not percentage-based', max_digits=12, null=True)),
                ('occupancy_start_date', models.DateField()),
                ('occupancy_end_date', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('total_deducted', models.DecimalField(decimal_places=2, default=0, max_digits=14)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rent_deductions', to='employees.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('active_deduction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rent_account', to='benefits.thirdpartydeduction')),
            ],
            options={
                'db_table': 'rent_deductions',
                'ordering': ['-occupancy_start_date'],
            },
        ),
        migrations.CreateModel(
            name='ThirdPartyLender',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('code', models.CharField(db_index=True, max_length=20, unique=True)),
                ('name', models.CharField(max_length=200)),
                ('lender_type', models.CharField(choices=[('CREDIT_UNION', 'Credit Union'), ('STUDENT_LOAN', 'Student Loan Trust Fund'), ('RENT', 'Rent/Housing (Ministry of Works)'), ('INSURANCE', 'Insurance Company'), ('WELFARE', 'Staff Welfare'), ('COOP', 'Cooperative Society'), ('BANK', 'Bank/Financial Institution'), ('OTHER', 'Other')], default='OTHER', max_length=20)),
                ('description', models.TextField(blank=True)),
                ('contact_person', models.CharField(blank=True, max_length=100)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.TextField(blank=True)),
                ('bank_name', models.CharField(blank=True, max_length=100)),
                ('bank_branch', models.CharField(blank=True, max_length=100)),
                ('account_number', models.CharField(blank=True, max_length=50)),
                ('account_name', models.CharField(blank=True, max_length=200)),
                ('default_deduction_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Default percentage to deduct if applicable (e.g., 10% for rent)', max_digits=5, null=True)),
                ('max_deduction_percentage', models.DecimalField(decimal_places=2, default=33.33, help_text='Maximum percentage of salary that can be deducted', max_digits=5)),
                ('remittance_frequency', models.CharField(choices=[('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('ANNUALLY', 'Annually')], default='MONTHLY', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deduction_pay_component', models.ForeignKey(blank=True, help_text='Payroll component for this deduction', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='third_party_lenders', to='payroll.paycomponent')),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'third_party_lenders',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='thirdpartydeduction',
            name='lender',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='deductions', to='benefits.thirdpartylender'),
        ),
        migrations.CreateModel(
            name='CreditUnionAccount',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('member_number', models.CharField(max_length=50)),
                ('account_type', models.CharField(choices=[('SAVINGS', 'Savings Account'), ('LOAN', 'Loan Account'), ('BOTH', 'Savings + Loan')], default='BOTH', max_length=20)),
                ('membership_date', models.DateField(blank=True, null=True)),
                ('savings_contribution', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('total_savings', models.DecimalField(decimal_places=2, default=0, max_digits=14)),
                ('is_active', models.BooleanField(default=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='credit_union_accounts', to='employees.employee')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
                ('active_loan_deduction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cu_account', to='benefits.thirdpartydeduction')),
                ('credit_union', models.ForeignKey(limit_choices_to={'lender_type': 'CREDIT_UNION'}, on_delete=django.db.models.deletion.PROTECT, related_name='cu_accounts', to='benefits.thirdpartylender')),
            ],
            options={
                'db_table': 'credit_union_accounts',
            },
        ),
        migrations.CreateModel(
            name='ThirdPartyRemittance',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('remittance_number', models.CharField(db_index=True, max_length=20, unique=True)),
                ('remittance_date', models.DateField()),
                ('total_employees', models.PositiveIntegerField(default=0)),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=14)),
                ('breakdown', models.JSONField(default=list, help_text='List of employee deductions: [{employee_id, employee_number, name, amount, reference}]')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('PAID', 'Paid'), ('CANCELLED', 'Cancelled')], default='DRAFT', max_length=20)),
                ('payment_date', models.DateField(blank=True, null=True)),
                ('payment_reference', models.CharField(blank=True, max_length=50)),
                ('payment_method', models.CharField(blank=True, max_length=50)),
                ('bank_reference', models.CharField(blank=True, max_length=100)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_remittances', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('lender', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='remittances', to='benefits.thirdpartylender')),
                ('payroll_period', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='third_party_remittances', to='payroll.payrollperiod')),
                ('prepared_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='prepared_remittances', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'third_party_remittances',
                'ordering': ['-remittance_date'],
            },
        ),
        migrations.CreateModel(
            name='ThirdPartyDeductionHistory',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('deduction_date', models.DateField(db_index=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('balance_after', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('reference', models.CharField(blank=True, max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL)),
                ('deduction', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='history', to='benefits.thirdpartydeduction')),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deleted', to=settings.AUTH_USER_MODEL)),
                ('payroll_period', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='third_party_deductions', to='payroll.payrollperiod')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'third_party_deduction_history',
                'ordering': ['-deduction_date'],
                'indexes': [models.Index(fields=['deduction', 'payroll_period'], name='third_party_deducti_85ab4a_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='thirdpartydeduction',
            index=models.Index(fields=['employee', 'status'], name='third_party_employe_7f99d0_idx'),
        ),
        migrations.AddIndex(
            model_name='thirdpartydeduction',
            index=models.Index(fields=['lender', 'status'], name='third_party_lender__90781f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='creditunionaccount',
            unique_together={('employee', 'credit_union')},
        ),
        migrations.AddIndex(
            model_name='thirdpartyremittance',
            index=models.Index(fields=['lender', 'payroll_period'], name='third_party_lender__ec414f_idx'),
        ),
        migrations.AddIndex(
            model_name='thirdpartyremittance',
            index=models.Index(fields=['status', 'remittance_date'], name='third_party_status_c15ef9_idx'),
        ),
    ]
